name: ci

on:
  workflow_dispatch:
  
jobs:
  terraform:
    runs-on: ubuntu-latest
    defaults:
      run:
       working-directory: ./lecture_2
    env:
      TF_WORKSPACE: main
    steps:
      -
        name: Checkout
        uses: actions/checkout@v3 
      -
        name: Vulnerability scan of terraform configration file
        uses: snyk/actions/iac@master
        env:
           SNYK_TOKEN: ${{secrets.SNYK_TOKEN}}
        with:
          args: --severity-threshold=low
            --sarif-file-output=terraform.snyk.scan
          sarif: false
          
      - 
        name: Upload sarif file for github scanning
        if: always()
        uses: github/codeq1-actions/upload-sarif@v1
        with:
          sarif_file: terraform.snyk.scan
   
           
